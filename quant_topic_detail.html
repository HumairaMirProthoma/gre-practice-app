<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéØ GRE Quant Practice ‚Äì Topic</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
<header>
  <div class="navbar">
    <div class="navbar-title">üéì GRE Practice App</div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="quant.html">Quant</a>
      <a href="verbal.html">Verbal</a>
    </div>
  </div>
</header>
<main style="padding: 2rem;">
  <h2 id="topicTitle" style="font-size: 1.7rem; margin-bottom: 2rem; text-align: center;">Loading Topic...</h2>
  <div id="questionsContainer"></div>
  <div style="text-align:center; margin-top: 2rem;">
    <button onclick="resetQuestions()" class="reset-btn">Reset All Questions</button>
  </div>
</main>
<footer>
  <p style="text-align:center; padding:1rem;">¬© 2025 GRE Practice App by YourName</p>
</footer>
<script>
const urlParams = new URLSearchParams(window.location.search);
const topic = urlParams.get('topic');
document.getElementById('topicTitle').textContent = topic.replace(/_/g, ' ').toUpperCase();

const STORAGE_KEY = `gre_${topic}_answers`;
const savedAnswers = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

fetch(`data/${topic}.json`)
  .then(res => res.json())
  .then(data => renderQuestions(data))
  .catch(() => {
    document.getElementById('questionsContainer').innerHTML = '<p style="color:red">Questions could not be loaded.</p>';
  });

function renderQuestions(questions) {
  const container = document.getElementById('questionsContainer');
  questions.forEach((q, index) => {
    const card = document.createElement('div');
    card.className = 'glass-card';
    card.id = `q-${q.id}`;

    let content = `<p><strong>Q${index + 1}:</strong></p>`;

    // Render comparison quantities in column layout
    if (q.type === 'comparison' && q.layout === 'columns') {
      const [left, right] = q.question.split('|||');
      content += `<div class="comparison-grid">
                    <div><strong>Quantity A</strong><br>${left.trim()}</div>
                    <div><strong>Quantity B</strong><br>${right.trim()}</div>
                  </div>`;
    } else {
      content += `<p>${q.question}</p>`;
    }

    // Render options
    const name = `q_${q.id}`;
    if (q.type === 'multiple' || (q.type === 'comparison' && q.multiple)) {
      content += q.options.map(opt => `<label><input type="checkbox" name="${name}" value="${opt}"> ${opt}</label><br>`).join('');
    } else {
      content += q.options.map(opt => `<label><input type="radio" name="${name}" value="${opt}"> ${opt}</label><br>`).join('');
    }

    // Submit and feedback section
    content += `
      <button class="submit-btn" onclick="submitAnswer(${q.id}, ${JSON.stringify(q).replace(/"/g, '&quot;')})">Submit</button>
      <p class="feedback" id="fb-${q.id}" style="margin-top: 0.5rem;"></p>
      <button class="solution-btn" id="solbtn-${q.id}" style="display:none;" onclick="toggleSolution(${q.id})">See Solution</button>
      <div class="solution-box" id="solution-${q.id}" style="display:none;">${q.solution}</div>
    `;

    card.innerHTML = content;
    container.appendChild(card);

    if (savedAnswers[q.id]) {
      const sel = savedAnswers[q.id];
      const inputs = card.querySelectorAll(`input[name='${name}']`);
      inputs.forEach(input => {
        if (sel.selected.includes(input.value)) input.checked = true;
      });
      const fb = document.getElementById(`fb-${q.id}`);
      fb.textContent = sel.feedback;
      fb.style.color = sel.feedback.includes('Correct') ? 'lightgreen' : 'orange';
      document.getElementById(`solbtn-${q.id}`).style.display = 'inline-block';
    }
  });
}

function submitAnswer(id, q) {
  const name = `q_${id}`;
  const selected = [...document.querySelectorAll(`input[name='${name}']:checked`)].map(i => i.value);
  const fb = document.getElementById(`fb-${id}`);

  if (selected.length === 0) return;

  let correct = false;
  if (q.type === 'multiple' || (q.type === 'comparison' && q.multiple)) {
    correct = JSON.stringify(selected.sort()) === JSON.stringify(q.correctAnswer.sort());
  } else {
    correct = selected[0] === q.correctAnswer[0];
  }

  fb.textContent = correct ? '‚úÖ Correct Answer' : '‚ùå Wrong Answer';
  fb.style.color = correct ? 'lightgreen' : 'orange';

  document.getElementById(`solbtn-${id}`).style.display = 'inline-block';

  savedAnswers[id] = {
    selected,
    feedback: fb.textContent
  };
  localStorage.setItem(STORAGE_KEY, JSON.stringify(savedAnswers));
}

function toggleSolution(id) {
  const sol = document.getElementById(`solution-${id}`);
  sol.style.display = sol.style.display === 'none' ? 'block' : 'none';
}

function resetQuestions() {
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
}
</script>
</body>
</html>
